---
title: "MAST-HMM and HMMSTER"
params:
  # general
  rmddir: ""
  prefix: ""
  outdir: ""
  redo: FALSE
  
  # sequence simulation
  iqtree2dir: ""
  
  # masthmm
  analysis_type: "MASTHMM"
  mast_model: ""
  mast_tops: 0.95
---

```{r setup, include=FALSE}
library(ape)
library(data.table)
library(dplyr)
library(forcats)
library(ggplot2)
library(log4r)

currentdir <- paste(params$outdir, "/", params$prefix, sep="")
if (!file.exists(currentdir)) {
  dir.create(currentdir, recursive = T)
}

fn_log <- paste(params$outdir, "/", params$prefix, "/", params$prefix, ".mh.log", sep="")
log_appender <- file_appender(fn_log, append = TRUE, layout = default_log_layout())
fn_logger <- log4r::logger(threshold = "INFO", appenders = log_appender)
if (params$redo == TRUE) {
  unlink(fn_log)
}

if (!file.exists(fn_log)) {
  write.table("SimNOW", file=fn_log, quote=F, row.names=F, col.names=F)
}

MASTHMM <- "MASTHMM"
HMMSTER <- "HMMSTER"
if (!params$analysis_type %in% c(MASTHMM,HMMSTER)) {
  log4r::error(fn_logger, "Error: invalid type of analysis. Exited.")
  knitr::knit_exit()
}

knitr::opts_knit$set(root.dir = currentdir)
```

## Analysis
```{r child = paste(params$rmddir,"/mh_run.Rmd",sep=""), include=FALSE}
```

## Summary
```{r child = paste(params$rmddir,"/mh_summary.Rmd",sep=""), include=FALSE}
```
