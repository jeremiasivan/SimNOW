---
title: "Non-overlapping Windows Analysis"
params:
  # general
  rmddir: "~/Documents/SimNOW/rmd"
  prefix: "ag"
  outdir: "~/Documents/simulation/debug"
  thread: 2
  redo: FALSE
  
  # ms
  msdir: "~/Documents/msdir/ms"
  ms_params: "7 1 -T -I 7 1 1 1 1 1 1 1 -ej 10 2 1 -ej 24 3 1 -ej 35 4 1 -ej 32 5 6 -ej 53 6 1 -ej 69 7 1 -es 1 2 0.25 -ej 1 8 1 -es 23 3 0.25 -ej 23 9 4 -es 34 6 0.25 -ej 34 10 4"
  ms_r: 30
  ms_l: 100000
  
  # AliSim
  iqtree2dir: "~/Downloads/iqtree-2.2.2.2-MacOSX/bin/iqtree2"
  alisim_model: "JC"
  alisim_scale: 0.001
  outgroup: "7"
  
  # non-overlapping window analysis
  window_size: !r c(20000,30000)
---

```{r setup, include=FALSE}
library(ape)
library(data.table)
library(doSNOW)
library(dplyr)
library(forcats)
library(ggplot2)
library(hash)
library(log4r)
library(seqinr)

# create outdir
currentdir <- paste0(params$outdir, "/", params$prefix)
if (!dir.exists(currentdir)) {
  dir.create(currentdir, recursive = T)
}

# create log file
fn_log <- paste0(params$outdir, "/", params$prefix, "/", params$prefix, ".log")
log_appender <- file_appender(fn_log, append = TRUE, layout = default_log_layout())
fn_logger <- log4r::logger(threshold = "INFO", appenders = log_appender)
if (params$redo) {
  unlink(fn_log)
}

if (!file.exists(fn_log)) {
  write.table("SimNOW", file=fn_log, quote=F, row.names=F, col.names=F)
}

knitr::opts_knit$set(root.dir = currentdir)
```

## Sequence Simulation
```{r child = paste(params$rmddir,"/nw_simulation.Rmd",sep=""), include=FALSE}
```

## Non-Overlapping Windows Analysis
```{r child = paste(params$rmddir,"/nw_run.Rmd",sep=""), include=FALSE}
```

## Summary
```{r child = paste(params$rmddir,"/nw_summary.Rmd",sep=""), include=FALSE}
```